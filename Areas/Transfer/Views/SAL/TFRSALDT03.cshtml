
@{
    ViewBag.Title = "TFRSALDT03";
}

<div class="container">
    <div class="page-inner">
        <div class="page-header">
            <h3 class="fw-bold mb-3">การสร้างใบส่งสินค้า</h3>
            <ul class="breadcrumbs mb-3">
                <li class="nav-home">
                    <a href="#">
                        <i class="icon-home"></i>
                    </a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Tables</a>
                </li>
                <li class="separator">
                    <i class="icon-arrow-right"></i>
                </li>
                <li class="nav-item">
                    <a href="#">Datatables</a>
                </li>
            </ul>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-6 col-lg-10">
                                <h3 class="card-title text-primary">สร้างใบส่งสินค้า</h3>
                            </div>
                            <div class="col-md-6 col-lg-2 d-flex" style="justify-content:flex-end !important">
                                <a href="@HttpUtility.UrlDecode(Url.Action("SALNRSRPT01", "RPT" , new {id = "Excel"}).ToString())" id="RPT_NRS" class="btn btn-success btn-round">
                                    <span class="btn-label"><i class="fas fa-print"></i></span>
                                    Print
                                </a>
                                <a href="@HttpUtility.UrlDecode(Url.Action("SALWNGRPT01", "RPT" , new {id = "Excel"}).ToString())" id="RPT_WNNG" class="btn btn-success btn-round">
                                    <span class="btn-label"><i class="fas fa-print"></i></span>
                                    Print
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 col-lg-6">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">เลชที่เอกสาร</span>
                                        <input type="text" id="SALE_DOC_ID" class="form-control" value="@Model.SALE_DOC_ID" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group">
                                    <div class="input-group mb-3 validate-input" data-validate="โปรดเลือกวันที่">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">วันที่</span>
                                        <input type="text" id="SALE_DT" class="form-control input-req-date" value="@(Model.SALE_DT == null ? "" : Convert.ToString(string.Format("{0:dd-MMM-yyyy}", Convert.ToDateTime(Model.SALE_DT))))" required />
                                        <span class="input-group-icon">
                                            <i class="fas fa-calendar-alt"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">สถานะ</span>
                                        <input type="text" id="DOC_STATUS" value="Draft" class="form-control" readonly />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">บริษัท</span>
                                        <select class="form-select form-control dropdown" id="CO_ID" name="CO_ID" disabled>
                                            <option value="" selected="selected"></option>
                                            @foreach (var sit in ViewBag.MAS_COMPANY)
                                            {
                                                <option value="@sit.CO_ID">@sit.CO_NM_TH</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3 validate-input" data-validate="โปรดเลือกพนักงาน">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">พนักงาน</span>
                                        <select class="form-select form-control dropdown input-req-date" id="USR_ID" name="USR_ID">
                                            <option></option>
                                            @foreach (var usr in ViewBag.MAS_USR)
                                            {
                                                <option value="@usr.USR_ID">@usr.PR_NAME @usr.F_NAME @usr.L_NAME</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-6">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">ฟาร์ม</span>
                                        <select class="form-select form-control dropdown" id="SITE_ID" name="SITE_ID" disabled>
                                            @foreach (var sit in ViewBag.MAS_SITE)
                                            {
                                                <option value="@sit.SITE_ID">@sit.SITE_NM_TH</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group">
                                    <div class="input-group mb-3 validate-input" data-validate="โปรดระบุเลขที่ใบชั่ง">
                                        <span class="input-group-text col-lg-4">เลขที่ใบชั่ง</span>
                                        <input type="text" id="WGHT_PPR_ID" value="@Model.WGHT_PPR_ID" class="form-control input-req" placeholder="Input Document No." style="color:blue" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <div class="form-group">
                                    <div class="input-group mb-3 validate-input" data-validate="โปรดเลือกประเภทค้า">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">ประเภท</span>
                                        <select class="form-select form-control input-req-date" id="PD_TP" disabled>
                                            <option value=""></option>
                                            <option value="1">สุกรขุน</option>
                                            <option value="2">ลูกสุกรหย่านม</option>
                                            <option value="3">สุกรอนุบาล</option>
                                            <option value="4">สุกรพ่อแม่พันธุ์คัดทิ้ง</option>
                                            <option value="5">สุกรพันธุ์</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3 validate-input" data-validate="โปรดเลือกลูกค้า">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">ลูกค้า</span>
                                        <select class="form-select form-control dropdown input-req-date" id="AC_NBR" name="AC_NBR">
                                            <option></option>
                                            @foreach (var cst in ViewBag.MAS_CST)
                                            {
                                                <option value="@cst.AC_NBR">@cst.YOUR_AC_NBR @cst.NM @cst.FRST_NM @cst.LAST_NM</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-8">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-3" id="basic-addon1">ที่อยู่</span>
                                        <select class="form-select form-control dropdown" id="CS_AC_NBR" name="CS_AC_NBR">
                                            <option value="">Please select Customer address</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">ผู้รับสินค้า</span>
                                        <input type="text" class="form-control" id="CONSIGNEE" value="@Model.CONSIGNEE" style="color:blue"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">ผู้ส่งสินค้า</span>
                                        <input type="text" class="form-control" id="SHIPPER" value="@Model.SHIPPER" style="color:blue"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">ผู้ตรวจสอบ</span>
                                        <input type="text" class="form-control" id="AUDITER" value="@Model.AUDITER" style="color:blue"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row-right">
                            <div class="col-md-6 col-lg-4">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text col-lg-4" id="basic-addon1">ผู้มีอำนาจลงนาม</span>
                                        <input type="text" class="form-control" id="SIGNATORY" value="@Model.SIGNATORY" style="color:blue"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="body1">
                            <ul class="nav nav-tabs nav-line nav-color-secondary" id="line-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="line-tab11-tab" data-bs-toggle="pill" href="#line-tab11" role="tab" aria-controls="pills-tab11" aria-selected="true">I.รายละเอียดใบส่งสินค้า</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="line-tab12-tab" data-bs-toggle="pill" href="#line-tab12" role="tab" aria-controls="pills-tab12" aria-selected="false">II.จำนวนเงินที่ต้องชำระ</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3 mb-3" id="line-tabContent">
                                <div class="tab-pane fade show active table-responsive tab-content mt-3 mb-3" id="line-tab11" role="tabpanel" aria-labelledby="line-tab11-tab">
                                    <table id="basic-datatables" style="width:100%" border="1"
                                           class="display table table-striped table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="5%" style="text-align:center !important">ลำดับ</th>
                                                <th width="20%" style="text-align:center !important">น้ำหนัก</th>
                                                <th width="20%" style="text-align:center !important">Note.</th>
                                                <th width="20%" style="text-align:center !important">เล้า</th>
                                                <th width="8%" style="align-content:center">
                                                    <div class="d-flex align-items-center selectgroup-pills">
                                                        <button type="button"
                                                                class="selectgroup-button selectgroup-button-icon">
                                                            <i class="fa fa-plus text-success"></i>
                                                        </button>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="2">รวม</th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="body2">
                            <ul class="nav nav-tabs nav-line nav-color-secondary" id="line-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="line-tab21-tab" data-bs-toggle="pill" href="#line-tab21" role="tab" aria-controls="pills-tab21" aria-selected="true">I.รายละเอียดใบส่งสินค้า</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="line-tab22-tab" data-bs-toggle="pill" href="#line-tab22" role="tab" aria-controls="pills-tab22" aria-selected="false">II.จำนวนเงินที่ต้องชำระ</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3 mb-3" id="line-tabContent">
                                <div class="tab-pane fade show active table-responsive tab-content mt-3 mb-3" id="line-tab21" role="tabpanel" aria-labelledby="line-tab21-tab">
                                    <table id="tb_wnng" style="width:100%" border="1"
                                           class="display table table-striped table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="5%" style="text-align:center !important">ลำดับ</th>
                                                <th width="5%" style="text-align:center !important">KEY</th>
                                                <th width="5%" style="text-align:center !important">SEQ</th>
                                                <th width="15%" style="text-align:center !important">จำนวน(ตัว)</th>
                                                <th width="15%" style="text-align:center !important">น้ำหนัก(กก.)</th>
                                                <th width="15%" style="text-align:center !important">เฉลี่ย(กก.)</th>
                                                <th width="10%" style="text-align:center !important">เล้า</th>
                                                <th width="8%" style="align-content:center">
                                                    <div class="d-flex align-items-center selectgroup-pills">
                                                        <button type="button"
                                                                id="BT-ADD_WNNG"
                                                                onclick="AddWnng(this)"
                                                                value="@Model.SALE_DOC_ID"
                                                                class="selectgroup-button selectgroup-button-icon">
                                                            <i class="fa fa-plus text-success"></i>
                                                        </button>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-pane fade tab-content mt-3 mb-3" id="line-tab22" role="tabpanel" aria-labelledby="line-tab22-tab">
                                    <label class="card-title text-primary">สุกร</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">สุกรหย่านม ช่วงอายุ</span>
                                                    <input type="text" id="PD_DESC_WNNG" class="form-control" style="color:blue"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวน</span>
                                                    <input type="text" id="PD_TOT_QTY_WNNG"
                                                           class="form-control int" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        ตัว
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา/หน่วย</span>
                                                    <input type="text" id="PD_PER_UNIT_WNNG" onchange="CalculateWnngFoot()"
                                                           class="form-control decimal" style="text-align: right;color:blue;" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="PD_AMT_WNNG"
                                                           class="form-control decimal" style="text-align: right;" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ค่าทำวัคซีน โปรแกรม</span>
                                                    <input type="text" id="VCNE_DESC_WNNG" class="form-control" style="color:blue"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา/หน่วย</span>
                                                    <input type="text" id="VCNE_PER_UNIT_WNNG" onchange="CalculateWnngFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="VCNE_AMT_WNNG"
                                                           class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="card-title text-primary">บวก</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ค่าขนส่ง(ถ้ามี)</span>
                                                    <input type="text" id="LGST_DESC_WNNG" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="LGST_PER_UNIT_WNNG" onchange="CalculateWnngFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>                                           
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="LGST_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">อื่นๆ(ระบุ)</span>
                                                    <input type="text" id="OTHR_PLS_DESC_WNNG" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="OTHR_PLS_PER_UNIT_WNNG" onchange="CalculateWnngFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="OTHR_PLS_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="card-title text-primary">หัก</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">อื่นๆ(ระบุ)</span>
                                                    <input type="text" id="OTHR_MNS_1_DESC_WNNG" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="OTHR_MNS_1_PER_UNIT_WNNG" onchange="CalculateWnngFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="OTHR_MNS_1_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-6"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">น้ำหนักเฉลียต่อตัว</span>
                                                    <input type="text" id="AV_WGHT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">รวมเงิน</span>
                                                    <input type="text" id="TOT_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-6"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">น้ำหนักรวม</span>
                                                    <input type="text" id="NET_WGHT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ส่วนลด</span>
                                                    <input type="text" id="DIS_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <button class="input-group-icon" onclick="EditDiscount()">&nbsp;<i class="fa fa-edit"></i>&nbsp;</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-9"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ยอดเงินสุทธิ</span>
                                                    <input type="text" id="NET_AMT_WNNG" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="body3">
                            <ul class="nav nav-tabs nav-line nav-color-secondary" id="line-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="line-tab31-tab" data-bs-toggle="pill" href="#line-tab31" role="tab" aria-controls="pills-tab31" aria-selected="true">I.รายละเอียดใบส่งสินค้า</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="line-tab32-tab" data-bs-toggle="pill" href="#line-tab32" role="tab" aria-controls="pills-tab32" aria-selected="false">II.จำนวนเงินที่ต้องชำระ</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3 mb-3" id="line-tabContent">
                                <div class="tab-pane fade show active table-responsive tab-content mt-3 mb-3" id="line-tab31">
                                    <table id="tb_nrs" style="width:100%" border="1"
                                           class="display table table-striped table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="5%" style="text-align:center !important">ลำดับ</th>
                                                <th width="5%" style="text-align:center !important">KEY</th>
                                                <th width="15%" style="text-align:center !important">จำนวน(ตัว)</th>
                                                <th width="15%" style="text-align:center !important">น้ำหนัก(กก.)</th>
                                                <th width="15%" style="text-align:center !important">เฉลี่ย(กก.)</th>
                                                <th width="10%" style="text-align:center !important">เล้า</th>
                                                <th width="8%" style="align-content:center">
                                                    <div class="d-flex align-items-center selectgroup-pills">
                                                        <button type="button"
                                                                id="BT-ADD_NRS"
                                                                onclick="AddNrs(this)"
                                                                value="@ViewBag.SALE_DOC_ID"
                                                                class="selectgroup-button selectgroup-button-icon">
                                                            <i class="fa fa-plus text-success"></i>
                                                        </button>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-pane fade tab-content mt-3 mb-3" id="line-tab32" role="tabpanel" aria-labelledby="line-tab32-tab">
                                    <label class="card-title text-primary">สุกร</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">สุกรหย่านม ช่วงอายุ</span>
                                                    <input type="text" id="PD_DESC_NRS"
                                                           class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวน</span>
                                                    <input type="text" id="PD_TOT_QTY_NRS"
                                                           class="form-control int" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        ตัว
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา/หน่วย</span>
                                                    <input type="text" id="PD_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="PD_AMT_NRS"
                                                           class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-7">นำหนักมาตรฐาน 16 กิโลกรัม</span>
                                                    <input type="text" id="STD_WGHT_NRS" class="form-control decimal" style="text-align: right;" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-7">นำหนักส่วนต่าง 16 กิโลกรัม</span>
                                                    <input type="text" id="EXD_STD_WGHT_NRS" class="form-control decimal" style="text-align: right;" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา/กก.</span>
                                                    <input type="text" id="EXD_STD_WGHT_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="EXD_STD_WGHT_AMT_NRS"
                                                           class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ค่าทำวัคซีน โปรแกรม</span>
                                                    <input type="text" id="VCNE_DESC_NRS" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา/หน่วย</span>
                                                    <input type="text" id="VCNE_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="VCNE_AMT_NRS"
                                                           class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="card-title text-primary">บวก</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ค่าขนส่ง(ถ้ามี)</span>
                                                    <input type="text" id="LGST_DESC_NRS" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="LGST_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="LGST_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">อื่นๆ(ระบุ)</span>
                                                    <input type="text" id="OTHR_PLS_DESC_NRS" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="OTHR_PLS_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="OTHR_PLS_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="card-title text-primary">หัก</label>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">อื่นๆ(ระบุ)</span>
                                                    <input type="text" id="OTHR_MNS_1_DESC_NRS" class="form-control" style="color:blue" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ราคา</span>
                                                    <input type="text" id="OTHR_MNS_1_PER_UNIT_NRS" onchange="CalculateNrsFoot()"
                                                           class="form-control decimal" style="text-align: right; color: blue" />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">จำนวนเงิน</span>
                                                    <input type="text" id="OTHR_MNS_1_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">บาท</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-6"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">น้ำหนักเฉลียต่อตัว</span>
                                                    <input type="text" id="AV_WGHT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">รวมเงิน</span>
                                                    <input type="text" id="TOT_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-6"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">น้ำหนักรวม</span>
                                                    <input type="text" id="NET_WGHT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        กก.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ส่วนลด</span>
                                                    <input type="text" id="DIS_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <button class="input-group-icon" onclick="EditDiscount()">&nbsp;<i class="fa fa-edit"></i>&nbsp;</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 col-lg-9"></div>
                                        <div class="col-md-6 col-lg-3">
                                            <div class="form-group">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-lg-5">ยอดเงินสุทธิ</span>
                                                    <input type="text" id="NET_AMT_NRS" class="form-control decimal" style="text-align: right" readonly />
                                                    <span class="input-group-icon">
                                                        บาท
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="body4">
                            <ul class="nav nav-tabs nav-line nav-color-secondary" id="line-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="line-tab41-tab" data-bs-toggle="pill" href="#line-tab41" role="tab" aria-controls="pills-tab41" aria-selected="true">รายละเอียดใบส่งสินค้า</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="line-tab42-tab" data-bs-toggle="pill" href="#line-tab42" role="tab" aria-controls="pills-tab42" aria-selected="false">จำนวนเงินที่ต้องชำระ</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3 mb-3" id="line-tabContent">
                                <div class="tab-pane fade show active table-responsive tab-content mt-3 mb-3" id="line-tab41">
                                    <table id="basic-datatables2" style="width:100%" border="1"
                                           class="display table table-striped table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="5%" style="text-align:center !important">ลำดับ</th>
                                                <th width="15%" style="text-align:center !important">เบอร์หู</th>
                                                <th width="15%" style="text-align:center !important">เพศ</th>
                                                <th width="15%" style="text-align:center !important">จำนวน</th>
                                                <th width="10%" style="text-align:center !important">เล้า</th>
                                                <th width="15%" style="text-align:center !important">น้ำหนัก</th>
                                                <th width="8%" style="align-content:center">
                                                    <div class="d-flex align-items-center selectgroup-pills">
                                                        <button type="button"
                                                                class="selectgroup-button selectgroup-button-icon">
                                                            <i class="fa fa-plus text-success"></i>
                                                        </button>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="body5">
                            <ul class="nav nav-tabs nav-line nav-color-secondary" id="line-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="line-tab51-tab" data-bs-toggle="pill" href="#line-tab51" role="tab" aria-controls="pills-tab51" aria-selected="true">รายละเอียดใบส่งสินค้า</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="line-tab52-tab" data-bs-toggle="pill" href="#line-tab52" role="tab" aria-controls="pills-tab52" aria-selected="false">จำนวนเงินที่ต้องชำระ</a>
                                </li>
                            </ul>
                            <div class="tab-content mt-3 mb-3" id="line-tabContent">
                                <div class="tab-pane fade show active table-responsive tab-content mt-3 mb-3" id="line-tab51">
                                    <table id="basic-datatables2" style="width:100%" border="1"
                                           class="display table table-striped table-hover table-bordered">
                                        <thead>
                                            <tr>
                                                <th width="5%" style="text-align:center !important">ลำดับ</th>
                                                <th width="15%" style="text-align:center !important">เบอร์หู</th>
                                                <th width="15%" style="text-align:center !important">เพศ</th>
                                                <th width="15%" style="text-align:center !important">จำนวน</th>
                                                <th width="10%" style="text-align:center !important">เล้า</th>
                                                <th width="15%" style="text-align:center !important">น้ำหนัก</th>
                                                <th width="8%" style="align-content:center">
                                                    <div class="d-flex align-items-center selectgroup-pills">
                                                        <button type="button"
                                                                class="selectgroup-button selectgroup-button-icon">
                                                            <i class="fa fa-plus text-success"></i>
                                                        </button>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-action">
                        <button id="SAVE" class="btn btn-primary btn-round fix btn-fixed-position">Update</button>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="card">
                    </div>
                </div>

            </div>
        </div>
    </div>
    <footer class="footer">
    </footer>
</div>
<div class="modal fade" id="m_modal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="false">
    <div class="modal-dialog modal-md" style="max-width: 1240px!important;padding-top: 80px;" role="document">
        <div class="modal-content card">
            <div class="modal-header">
                <h5 class="card-title">
                    บันทึกส่วนลด
                </h5>

                <!--<button type="button" class="close" style="justify-content:flex-end !important" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>-->
            </div>
            <div class="container">
                <div class="page-inner">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="table-responsive">
                                            <table id="tb_dis" style="width:100%" border="1" class="display table table-hover table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th width="2%" style="text-align:center !important">ลำดับ</th>
                                                        <th width="5%" style="text-align:center !important">KEY</th>
                                                        <th width="5%" style="text-align:center !important">SK</th>
                                                        <th width="5%" style="text-align:center !important">SALE ID</th>
                                                        <th width="5%" style="text-align:center !important">TYPE</th>
                                                        <th width="5%" style="text-align:center !important">CASE_OF_DCN</th>
                                                        <th width="20%" style="text-align:center !important">สาเหตุการให้ส่วนลด</th>
                                                        <th width="5%" style="text-align:center !important">จำนวน/ปริมาณ</th>
                                                        <th width="5%" style="text-align:center !important">ราคา</th>
                                                        <th width="5%" style="text-align:center !important">หน่วย</th>
                                                        <th width="5%" style="text-align:center !important">จำนวนเงิน</th>
                                                        <th width="5%" style="text-align:center !important">
                                                            <div class="d-flex align-items-center selectgroup-pills">
                                                                <button type="button"
                                                                        id="BT-ADD_DIS"
                                                                        onclick="AddDis(this)"
                                                                        value="@ViewBag.SALE_DOC_ID"
                                                                        class="selectgroup-button selectgroup-button-icon">
                                                                    <i class="fa fa-plus text-success"></i>
                                                                </button>
                                                            </div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex" style="justify-content:flex-end !important">
                <button id="add_discount" onclick="CallAddDiscount()" class="btn btn-primary btn-round">Add</button>
            </div>
        </div>
    </div>
</div>
<script>
    var MAS_HSG = @Html.Raw(Json.Encode(ViewBag.MAS_HSG));
    var MAS_DCN_CUST = @Html.Raw(Json.Encode(ViewBag.MAS_DCN_CUST));
    var tableWnng = null;
    $(document).ready(function () {
        $("#RPT_NRS").hide();
        $("#RPT_WNNG").hide();
        $(".int").inputmask({
            'alias': 'currency',
            'integerDigits': '12',
            'digits': 0,
            'prefix': '',
            rightAlign: true
        });
        $(".decimal").inputmask({
            'alias': 'currency',
            'integerDigits': '12',
            'digits': 2,
            'prefix': '',
            rightAlign: false,
        });
        hidedefault();
        $('#CO_ID').val('MJG').trigger("change");
        $('#SITE_ID').val('BT').trigger("change");
        $('#PD_TP').val('@Model.PD_TP').trigger("change")
        $('#AC_NBR').val('@Model.CST_ID').trigger("change")
        $('#USR_ID').val('@Model.USR_ID').trigger("change")
        $("#SALE_DT").datepicker({
            todayHighlight: true,
            orientation: 'bottom left',
            format: 'dd-M-yyyy',
            todayBtn: 'linked',
            autoclose: 'true',
            assumeNearbyYear: true
        });
        $('#CO_ID,#SITE_ID,#AC_NBR,#USR_ID,#CS_AC_NBR').select2({
            theme: "bootstrap-5",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
            placeholder: $(this).data('placeholder'),
            closeOnSelect: false,
            tags: true
        });

        tableWnng = $("#tb_wnng").DataTable({
            "searching": false,
            "paging": true,
            "ordering": true,
            "info": false,
            "bAutoWidth": false,
            "lengthChange": false,
            "order": [],
            responsive: !0,
            "columnDefs": [
                {
                    targets: [0],
                    orderable: false,
                    className: "text-center",
                },
                {
                    targets: [1,2],
                    orderable: false,
                    visible:false,
                    className: "text-center",
                },
                {
                    targets: [3, 4],
                    orderable: false,
                    className: "text-right",
                    mRender: function (data, type, full) {
                        return numeral(data).format('0,0');
                    }
                },
                {
                    targets: [5],
                    orderable: false,
                    className: "text-right",
                    mRender: function (data, type, full) {
                        return numeral(data).format('0,0.00');
                    }
                },
                {
                    targets: [6, 7],
                    orderable: false,
                    className: "text-center",
                },
            ],
            "columns": [
                {
                    "render": function (data, type, full, meta) {
                        var pageInfo = tableWnng.page.info();
                        return (meta.row + 1) + numeral(pageInfo.page)._value * numeral(pageInfo.length)._value;
                    }
                },
                { 'data': 'UK_KEY' },
                { 'data': 'SEQ' },
                {
                    'data': 'PD_AMT',
                    render: function (data, type, row, meta) {
                        return "<input type='text' class='form-control int' autocomplete='off' style='color:blue' onchange='ModifyDirectlyWnng(this)' id='PD_AMT--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' value='" + row.PD_AMT + "' style='text-align: right;'/>";
                    }
                },
                {
                    'data': 'PD_WGHT',
                    render: function (data, type, row, meta) {
                        return "<input type='text' class='form-control int' autocomplete='off' style='color:blue' onchange='ModifyDirectlyWnng(this)' id='PD_WGHT--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' value='" + row.PD_WGHT + "' style='text-align: right;'/>";
                    }
                },
                { 'data': 'PD_WGHT_AV' },
                {
                    'data': 'HSG_ID',
                    render: function (data, type, row, meta) {
                        var optionList = "";
                        $.each(MAS_HSG, function (index, item) {
                            if (row.HSG_ID !== null && row.HSG_ID == item.HSG_ID) {
                                optionList = optionList + ' <option selected="selected" style="color:blue" value="' + item.HSG_ID + '">' + item.HSG_ID + '</option> ';
                            } else {
                                optionList = optionList + ' <option value="' + item.HSG_ID + '">' + item.HSG_ID + '</option> ';
                            }
                        });
                        var select = "<div class='input-group'><select class='form-select dropdown wnng_select' onchange='ModifyDirectlyWnng(this)' id='HSG_ID--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "'> <option value=''></option>" + optionList + "</select></div>";
                        return select;
                    }
                },
                {
                    mRender: function (data, type, row, meta) {
                        var pageInfo = tableWnng.page.info();
                        return "<div class='d-flex align-items-center selectgroup-pills'><button type='button' onclick='DelWnng(this)' id='BT-DEL_MOVE--" + row.UK_KEY + "' class='selectgroup-button selectgroup-button-icon move_bt' ><i class='fas fa-trash text-danger'></i></button></div>";
                    }
                }
            ],
            "rowCallback": function (row, data, index) {
                var pageInfo = this.api().page.info();
                var row_index = (index + 1) + pageInfo.page * pageInfo.length;
                $('td:eq(0)', row).html(row_index);
                if (data.UK_KEY.split('--').length == 1) {
                    data.UK_KEY = data.UK_KEY + "--" + row_index;
                }

            },
            "drawCallback": function (settings, row, data, index) {
                var api = this.api();

                // Recalculate and update the index numbers after each draw
                api.column(0, { page: 'current' }).nodes().each(function (cell, i) {
                    var pageInfo = api.page.info();
                    var rowIndex = (i + 1) + pageInfo.page * pageInfo.length;
                    // Update the cell's content with the new row index
                    $(cell).html(rowIndex);
                });

                $(".int").inputmask({
                    'alias': 'currency',
                    'integerDigits': '12',
                    'digits': 0,
                    'prefix': '',
                    rightAlign: true
                });
                $(".wnng_select").each(function () {

                    $(this).select2({
                        theme: "bootstrap-5",
                        width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
                        placeholder: $(this).data('placeholder'),
                        closeOnSelect: false,
                        tags: true
                    });
                });
            }

        });

        tableNrs = $("#tb_nrs").DataTable({
            "searching": false,
            "paging": true,
            "ordering": true,
            "info": false,
            "bAutoWidth": false,
            "lengthChange": false,
            "order": [],
            responsive: !0,
            "columnDefs": [
                {
                    targets: [0],
                    orderable: false,
                    className: "text-center",
                },
                {
                    targets: [1],
                    orderable: false,
                    visible: false,
                    className: "text-center",
                },
                {
                    targets: [2, 3],
                    orderable: false,
                    className: "text-right",
                    mRender: function (data, type, full) {
                        return numeral(data).format('0,0');
                    }
                },
                {
                    targets: [4],
                    orderable: false,
                    className: "text-right",
                    mRender: function (data, type, full) {
                        return numeral(data).format('0,0.00');
                    }
                },
                {
                    targets: [5, 6],
                    orderable: false,
                    className: "text-center",
                },
            ],
            "columns": [
                {
                    "render": function (data, type, full, meta) {
                        var pageInfo = tableNrs.page.info();
                        return (meta.row + 1) + numeral(pageInfo.page)._value * numeral(pageInfo.length)._value;
                    }
                },
                { 'data': 'UK_KEY' },
                {
                    'data': 'PD_AMT',
                    render: function (data, type, row, meta) {
                        return "<input type='text' class='form-control int' autocomplete='off' style='color:blue' onchange='ModifyDirectlyNrs(this)' id='PD_AMT--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' value='" + row.PD_AMT + "' style='text-align: right;'/>";
                    }
                },
                {
                    'data': 'PD_WGHT',
                    render: function (data, type, row, meta) {
                        return "<input type='text' class='form-control int' autocomplete='off' style='color:blue' onchange='ModifyDirectlyNrs(this)' id='PD_WGHT--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' value='" + row.PD_WGHT + "' style='text-align: right;'/>";
                    }
                },
                { 'data': 'PD_WGHT_AV' },
                {
                    'data': 'HSG_ID',
                    render: function (data, type, row, meta) {
                        var optionList = "";
                        $.each(MAS_HSG, function (index, item) {
                            if (row.HSG_ID !== null && row.HSG_ID == item.HSG_ID) {
                                optionList = optionList + ' <option selected="selected" value="' + item.HSG_ID + '">' + item.HSG_ID + '</option> ';
                            } else {
                                optionList = optionList + ' <option value="' + item.HSG_ID + '">' + item.HSG_ID + '</option> ';
                            }
                        });
                        var select = "<div class='input-group'><select class='form-select dropdown nrs_select' onchange='ModifyDirectlyNrs(this)' id='HSG_ID--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "'> <option value=''></option>" + optionList + "</select></div>";
                        return select;
                    }
                },
                {
                    mRender: function (data, type, row, meta) {
                        var pageInfo = tableNrs.page.info();
                        return "<div class='d-flex align-items-center selectgroup-pills'><button type='button' onclick='DelNrs(this)' id='BT-DEL_WNNG--" + row.UK_KEY + "' class='selectgroup-button selectgroup-button-icon nrs_bt' ><i class='fas fa-trash text-danger'></i></button></div>";
                    }
                }
            ],
            "rowCallback": function (row, data, index) {
                var pageInfo = this.api().page.info();
                var row_index = (index + 1) + pageInfo.page * pageInfo.length;
                $('td:eq(0)', row).html(row_index);
                if (data.UK_KEY.split('--').length == 1) {
                    data.UK_KEY = data.UK_KEY + "--" + row_index;
                }

            },
            "drawCallback": function (settings, row, data, index) {
                var api = this.api();

                // Recalculate and update the index numbers after each draw
                api.column(0, { page: 'current' }).nodes().each(function (cell, i) {
                    var pageInfo = api.page.info();
                    var rowIndex = (i + 1) + pageInfo.page * pageInfo.length;
                    // Update the cell's content with the new row index
                    $(cell).html(rowIndex);
                });

                $(".int").inputmask({
                    'alias': 'currency',
                    'integerDigits': '12',
                    'digits': 0,
                    'prefix': '',
                    rightAlign: true
                });
                $(".nrs_select").each(function () {

                    $(this).select2({
                        theme: "bootstrap-5",
                        width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
                        placeholder: $(this).data('placeholder'),
                        closeOnSelect: false,
                        tags: true
                    });
                });
            }

        });

        tableDis = $("#tb_dis").DataTable({
            "searching": false,
            "paging": true,
            "ordering": true,
            "info": false,
            "bAutoWidth": false,
            "lengthChange": false,
            "order": [],
            responsive: !0,
            "columnDefs": [
                {
                    targets: [0],
                    orderable: false,
                    className: "text-center",
                },
                {
                    targets: [1, 2, 3, 4, 5],
                    orderable: false,
                    visible: false,
                    className: "text-center",
                },
                {
                    targets: [10],
                    orderable: false,
                    className: "text-right",
                    mRender: function (data, type, full) {
                        return numeral(data).format('0,0');
                    }
                },
                {
                    targets: [6, 7, 8, 9, 11],
                    orderable: false,
                    className: "text-center",
                },
            ],
            "columns": [
                {
                    "render": function (data, type, full, meta) {
                        var pageInfo = tableDis.page.info();
                        return (meta.row + 1) + numeral(pageInfo.page)._value * numeral(pageInfo.length)._value;
                    }
                },
                { 'data': 'UK_KEY' },
                { 'data': 'AVY_SALE_FOTR_DCN_SK', },
                { 'data': 'SALE_DOC_ID', },
                { 'data': 'TP_PIG' },
                { 'data': 'CASE_OF_DCN' },
                {
                    'data': 'DCN_CUST_ID',
                    render: function (data, type, row, meta) {
                        var optionList = "";
                        $.each(MAS_DCN_CUST, function (index, item) {
                            if (row.DCN_CUST_ID !== null && row.DCN_CUST_ID == item.DCN_CUST_ID) {
                                optionList = optionList + ' <option selected="selected" title="' + item.DCN_FOR_CTR_CUST + '" value="' + item.DCN_CUST_ID + '">' + item.CASE_OF_DCN + '</option> ';
                            } else {
                                optionList = optionList + ' <option value="' + item.DCN_CUST_ID + '">' + item.CASE_OF_DCN + '</option> ';
                            }
                        });
                        var select = "<div class='input-group'><select class='form-select dropdown dcn_select' onchange='ModifyDirectlyDis(this)' id='DCN_CUST_ID--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' > <option value=''></option>" + optionList + "</select></div>";
                        return select;
                    }
                },
                {
                    'data': 'DCN_QTY',
                    render: function (data, type, row, meta) {
                        return "<input type='text' class='form-control int' autocomplete='off' style='color:blue' onchange='ModifyDirectlyDis(this)' id='DCN_QTY--" + row.UK_KEY + "' row='" + meta.row + "' col='" + meta.col + "' value='" + row.DCN_QTY + "' style='text-align: right;'/>";
                    }
                },
                { 'data': 'DCN_FOR_CTR_CUST_AMT' },
                { 'data': 'DCN_UNIT' },
                { 'data': 'TOT_AMT' },
                {
                    mRender: function (data, type, row, meta) {
                        var pageInfo = tableDis.page.info();
                        return "<div class='d-flex align-items-center selectgroup-pills'><button type='button' onclick='DelDis(this)' id='BT-DEL_DIS--" + row.UK_KEY + "' class='selectgroup-button selectgroup-button-icon wnng_bt' ><i class='fas fa-trash text-danger'></i></button></div>";
                    }
                }
            ],
            "rowCallback": function (row, data, index) {
                var pageInfo = this.api().page.info();
                var row_index = (index + 1) + pageInfo.page * pageInfo.length;
                $('td:eq(0)', row).html(row_index);
                if (data.UK_KEY.split('--').length == 1) {
                    data.UK_KEY = data.UK_KEY + "--" + row_index;
                }

            },
            "drawCallback": function (settings, row, data, index) {
                var api = this.api();

                // Recalculate and update the index numbers after each draw
                api.column(0, { page: 'current' }).nodes().each(function (cell, i) {
                    var pageInfo = api.page.info();
                    var rowIndex = (i + 1) + pageInfo.page * pageInfo.length;
                    // Update the cell's content with the new row index
                    $(cell).html(rowIndex);
                });

                $(".int").inputmask({
                    'alias': 'currency',
                    'integerDigits': '12',
                    'digits': 0,
                    'prefix': '',
                    rightAlign: true
                });
                $(".dcn_select").each(function () {

                    $(this).select2({
                        theme: "bootstrap-5",
                        width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
                        placeholder: $(this).data('placeholder'),
                        closeOnSelect: false,
                        tags: true
                    });
                });
            }
        });
        if ($("#PD_TP").val() == 2) {
            SelectWnngDetail();
            $("#RPT_WNNG").show();
        } else if ($("#PD_TP").val() == 3) {
            SelectNrsDetail();
            $("#RPT_NRS").show();
        }

    });
    $("#PD_TP").change(function () {
        hideaffterselect();
        if ($("#PD_TP").val() == 1) {
            $("#body1").show();
        } else if ($("#PD_TP").val() == 2) {
            $("#body2").show();           
        } else if ($("#PD_TP").val() == 3) {
            $("#body3").show();
        } else if ($("#PD_TP").val() == 4) {
            $("#body4").show();
        } else if ($("#PD_TP").val() == 5) {
            $("#body5").show();
        } else {
            hidedefault();
        }
    });
    function hidedefault() {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
        $("#body4").hide();
        $("#body5").hide();
    }
    function hideaffterselect() {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
        $("#body4").hide();
        $("#body5").hide();

    }

    function SelectWnngDetail() {
        var doc = $("#SALE_DOC_ID").val();
        $.ajax({
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_SELECT_WNNG_DETAIL",
            dataType: "json",
            cache: false,
            data: { SALE_DOC_ID: doc },
            success: function (data) {
                var AVY_SALES_DTL = data.AVY_SALES_DTL;
                AVY_SALES_DTL = data.AVY_SALES_DTL;
                tableWnng.clear().draw();
                tableWnng.rows.add(AVY_SALES_DTL).draw();
                console.log("Row Detail first : " + tableWnng.data().length);
                WnngReGenerate();
                SelectWnngFooter();
                SelectDiscount();
            },
            error: function () {
                errorAlert.init();
            }
        });
    }
    function SelectWnngFooter() {
        var doc = $("#SALE_DOC_ID").val();
        $.ajax({
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_SELECT_WNNG_FOOTER",
            dataType: "json",
            cache: false,
            data: { SALE_DOC_ID: doc },
            success: function (data) {
                var AVY_SALES_FOTR_WNNG = data.AVY_SALES_FOTR_WNNG;
                $("#PD_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.PD_DESC);
                $("#PD_TOT_QTY_WNNG").val(AVY_SALES_FOTR_WNNG.PD_TOT_QTY);
                $("#PD_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.PD_PER_UNIT);
                $("#VCNE_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.VCNE_DESC);
                $("#VCNE_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.VCNE_PER_UNIT);
                $("#LGST_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.LGST_DESC);
                $("#LGST_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.LGST_PER_UNIT);
                $("#OTHR_PLS_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_PLS_DESC);
                $("#OTHR_PLS_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_PLS_PER_UNIT);
                $("#OTHR_MNS_1_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_MNS_1_DESC);
                $("#OTHR_MNS_1_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_MNS_1_PER_UNIT);
                $("#OTHR_MNS_2_DESC_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_MNS_2_DESC);
                $("#OTHR_MNS_2_PER_UNIT_WNNG").val(AVY_SALES_FOTR_WNNG.OTHR_MNS_2_PER_UNIT);
                $("#AV_WGHT_WNNG").val(AVY_SALES_FOTR_WNNG.AV_WGHT);
                $("#NET_WGHT_WNNG").val(AVY_SALES_FOTR_WNNG.NET_WGHT);
                $("#TOT_AMT_WNNG").val(AVY_SALES_FOTR_WNNG.TOT_AMT);
                $("#DIS_AMT_WNNG").val(AVY_SALES_FOTR_WNNG.DIS_AMT);
                $("#NET_AMT_WNNG").val(AVY_SALES_FOTR_WNNG.NET_AMT);
                CalculateWnngFoot();
            },
            error: function () {
                errorAlert.init();
            }
        });
    }

    function SelectNrsDetail() {
        var doc = $("#SALE_DOC_ID").val();
        $.ajax({
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_SELECT_NRS_DETAIL",
            dataType: "json",
            cache: false,
            data: { SALE_DOC_ID: doc },
            success: function (data) {
                var AVY_SALES_DTL = data.AVY_SALES_DTL;
                AVY_SALES_DTL = data.AVY_SALES_DTL;
                tableNrs.clear().draw();
                tableNrs.rows.add(AVY_SALES_DTL).draw();
                console.log("Row Detail first : " + tableNrs.data().length);
                NrsReGenerate();
                SelectNrsFooter();
                SelectDiscount();
            },
            error: function () {
                errorAlert.init();
            }
        });
    }
    function SelectNrsFooter() {
        var doc = $("#SALE_DOC_ID").val();
        $.ajax({
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_SELECT_NRS_FOOTER",
            dataType: "json",
            cache: false,
            data: { SALE_DOC_ID: doc },
            success: function (data) {
                var AVY_SALES_FOTR_NRSRY = data.AVY_SALES_FOTR_NRSRY;
                $("#PD_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.PD_DESC);
                $("#PD_TOT_QTY_NRS").val(AVY_SALES_FOTR_NRSRY.PD_TOT_QTY);
                $("#PD_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.PD_PER_UNIT);
                $("#STD_WGHT_NRS").val(AVY_SALES_FOTR_NRSRY.STD_WGHT);
                $("#EXD_STD_WGHT_NRS").val(AVY_SALES_FOTR_NRSRY.EXD_STD_WGHT);
                $("#EXD_STD_WGHT_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.EXD_STD_WGHT_PER_UNIT);
                $("#EXD_STD_WGHT_AMT_NRS").val(numeral($("#EXD_STD_WGHT_NRS").val())._value * numeral($("#EXD_STD_WGHT_PER_UNIT_NRS").val())._value);
                $("#VCNE_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.VCNE_DESC);
                $("#VCNE_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.VCNE_PER_UNIT);
                $("#LGST_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.LGST_DESC);
                $("#LGST_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.LGST_PER_UNIT);
                $("#OTHR_PLS_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_PLS_DESC);
                $("#OTHR_PLS_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_PLS_PER_UNIT);
                $("#OTHR_MNS_1_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_MNS_1_DESC);
                $("#OTHR_MNS_1_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_MNS_1_PER_UNIT);
                $("#OTHR_MNS_2_DESC_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_MNS_2_DESC);
                $("#OTHR_MNS_2_PER_UNIT_NRS").val(AVY_SALES_FOTR_NRSRY.OTHR_MNS_2_PER_UNIT);
                $("#AV_WGHT_NRS").val(AVY_SALES_FOTR_NRSRY.AV_WGHT);
                $("#NET_WGHT_NRS").val(AVY_SALES_FOTR_NRSRY.NET_WGHT);
                $("#TOT_AMT_NRS").val(AVY_SALES_FOTR_NRSRY.TOT_AMT);
                $("#DIS_AMT_NRS").val(AVY_SALES_FOTR_NRSRY.DIS_AMT);
                $("#NET_AMT_NRS").val(AVY_SALES_FOTR_NRSRY.NET_AMT);
                CalculateNrsFoot();
            },
            error: function () {
                errorAlert.init();
            }
        });
    }
    function SelectDiscount() {
        var doc = $("#SALE_DOC_ID").val();
        $.ajax({
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_SELECT_FDCN",
            dataType: "json",
            cache: false,
            data: { SALE_DOC_ID: doc },
            success: function (data) {
                var AVY_SALES_FOTR_DCN = data.AVY_SALES_FOTR_DCN;
                tableDis.clear().draw();
                tableDis.rows.add(AVY_SALES_FOTR_DCN).draw();
                DisReGenerate();
            },
            error: function () {
                errorAlert.init();
            }
        });
    }

    $('#AC_NBR').change(function () {
        if ($("#AC_NBR").val() != "") {
            var selectID = $("#AC_NBR").val();
            $.ajax({
                type: "GET",
                url: pathServer + "/SAL/Get_Address",
                data: {
                    selectID: selectID,
                },
                success: function (response) {
                    $('#CS_AC_NBR').empty()
                    $.each(response, function (index, value) {
                        $('#CS_AC_NBR').append($('<option/>', {
                            value: response[index].CS_AC_NBR,
                            text: response[index].STR + response[index].CITY + ' ' + response[index].CNTY + ' ' + response[index].STE + ' ' +  response[index].ZIP_CODE
                        }));
                    });
                    if ($("#CS_AC_NBR").val() != "") {
                        $($(CS_AC_NBR).parent()).removeClass('alert-validate-date');
                    }
                },
                error: function (xhr) {
                    //Do Something to handle error
                }
            });
        }
    });
    function AddWnng(btn) {
        Swal.fire({
            title: "Are you sure?",
            text: "คุณแน่ใจที่จะเพิ่ม 20 รายการใช่หรือไม่!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, add it!"
        }).then((result) => {
            if (result.isConfirmed) {
                var key = $("#BT-ADD_WNNG").val();
                var i = 0;
                while (i < 20) {
                    tableWnng.row.add({
                        "UK_KEY": key,
                        "SEQ": "",
                        "PD_AMT": 5,
                        "HSG_ID": "",
                        "PD_WGHT": 0,
                        "PD_WGHT_AV": 0
                    }).draw(false);
                    i++;
                }

                WnngReGenerate();
            }
        });

    }
    function WnngReGenerate() {
        var pageInfo = tableWnng.page.info();
        tableWnng.rows().every(function (index) {
            var rowData = this.data();
            var newUK_KEY = String(rowData.UK_KEY).split('--')[0] + "--" + (index + 1);
            rowData.UK_KEY = newUK_KEY; // Update UK_KEY in row data
            this.data(rowData);
        });
        tableWnng.page(pageInfo.page).draw(false);
    }
    function ModifyDirectlyWnng(btn) {
        var id = $(btn).attr('id');
        var row = $(btn).attr('row');
        var col = $(btn).attr('col');
        var new_values = $("#" + id).val();
        var key = id.split('--')[1] + '--' + id.split('--')[2];

        console.log("New: " + key);
        var indexWnng = tableWnng
            .rows()
            .indexes()
            .filter(function (value, index) {
                return key === tableWnng.row(value).data().UK_KEY;
            });

        if (indexWnng !== undefined && tableWnng.row(indexWnng).length > 0) {
            var page = tableWnng.page.info();
            tableWnng.page(page.page).cell(row, col).data(new_values).draw(false);
            CalculateWnng(indexWnng);
            CalculateWnngFoot();
        } else {
            console.log("Invalid row index:", indexWnng);
        }
    }

    function CalculateWnng(indexWnng) {
        var page = tableWnng.page.info();
        if (numeral(tableWnng.row(indexWnng).data().PD_AMT)._value > 0 && numeral(tableWnng.row(indexWnng).data().PD_WGHT)._value > 0) {
            tableWnng.row(indexWnng).data().PD_WGHT_AV = (numeral(tableWnng.row(indexWnng).data().PD_WGHT)._value / numeral(tableWnng.row(indexWnng).data().PD_AMT)._value);
        }
        tableWnng.row(indexWnng).data(tableWnng.row(indexWnng).data()).draw();
        tableWnng.page(page.page).draw(false);
    }

    function CalculateWnngFoot() {
        var sum_PD_TOT_QTY = 0;
        var sum_PD_WGHT = 0;
        for (var i = 0; i < tableWnng.data().length; i++) {
            sum_PD_TOT_QTY = numeral(sum_PD_TOT_QTY)._value + numeral(tableWnng.data()[i].PD_AMT)._value;
            sum_PD_WGHT = numeral(sum_PD_WGHT)._value + numeral(tableWnng.data()[i].PD_WGHT)._value;
        }
        console.log("Row Detail last: " + tableWnng.data().length + "|" + $("#PD_PER_UNIT_WNNG").val());
        $("#PD_TOT_QTY_WNNG").val(numeral(sum_PD_TOT_QTY)._value);
        $("#PD_AMT_WNNG").val(numeral(sum_PD_TOT_QTY)._value * numeral($("#PD_PER_UNIT_WNNG").val())._value);
        $("#VCNE_AMT_WNNG").val(numeral(sum_PD_TOT_QTY)._value * numeral($("#VCNE_PER_UNIT_WNNG").val())._value);
        $("#LGST_AMT_WNNG").val(numeral($("#LGST_PER_UNIT_WNNG").val())._value);
        $("#OTHR_PLS_AMT_WNNG").val(numeral($("#OTHR_PLS_PER_UNIT_WNNG").val())._value);
        $("#OTHR_MNS_1_AMT_WNNG").val(numeral($("#OTHR_MNS_1_PER_UNIT_WNNG").val())._value);
        $("#OTHR_MNS_2_AMT_WNNG").val(numeral($("#OTHR_MNS_2_PER_UNIT_WNNG").val())._value);
        $("#NET_WGHT_WNNG").val(numeral(sum_PD_WGHT)._value);
        $("#AV_WGHT_WNNG").val(sum_PD_WGHT / sum_PD_TOT_QTY);
        $("#TOT_AMT_WNNG").val(numeral($("#PD_AMT_WNNG").val())._value + numeral($("#VCNE_AMT_WNNG").val())._value + numeral($("#LGST_AMT_WNNG").val())._value +
            numeral($("#OTHR_PLS_AMT_WNNG").val())._value - (numeral($("#OTHR_MNS_1_AMT_WNNG").val())._value + numeral($("#OTHR_MNS_2_AMT_WNNG").val())._value));
        $("#NET_AMT_WNNG").val(numeral($("#TOT_AMT_WNNG").val())._value - numeral($("#DIS_AMT_WNNG").val())._value);

    }

    function DelWnng(btn) {
        var id = $(btn).attr('id');
        var idx = $(btn).attr('idx');
        var key = id.split('--')[1] + "--" + id.split('--')[2];

        var indexHead = tableWnng
            .rows()
            .indexes()
            .filter(function (value, index) {
                //console.log(key + "|" + tableWnng.row(value).data().UK_KEY);
                return key === tableWnng.row(value).data().UK_KEY;
            }); // หา row ที่ต้องการจะลบ
        Swal.fire({
            icon: "warning",
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            showCancelButton: true,
            confirmButtonText: 'Yes',
        }).then((result) => {
            if (result.isConfirmed) {
                var page = tableWnng.page.info();
                tableWnng.rows(indexHead).remove().page(page.page).draw(); // ลบ row ที่ค้นหา
                WnngReGenerate();
                CalculateWnngFoot();
            }
        });
    }

    function AddNrs(btn) {
        Swal.fire({
            title: "Are you sure?",
            text: "คุณแน่ใจที่จะเพิ่ม 20 รายการใช่หรือไม่!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, add it!"
        }).then((result) => {
            if (result.isConfirmed) {
                var key = $("#BT-ADD_NRS").val();
                var i = 0;
                while (i < 20) {
                    tableNrs.row.add({
                        "UK_KEY": key,
                        "PD_AMT": 5,
                        "HSG_ID": "",
                        "PD_WGHT": 0,
                        "PD_WGHT_AV": 0
                    }).draw(false);
                    i++;
                }

                NrsReGenerate();
            }
        });
    }

    function NrsReGenerate() {
        var pageInfo = tableNrs.page.info();
        tableNrs.rows().every(function (index) {
            var rowData = this.data();
            var newUK_KEY = String(rowData.UK_KEY).split('--')[0] + "--" + (index + 1);
            rowData.UK_KEY = newUK_KEY; // Update UK_KEY in row data
            this.data(rowData);
        });
        tableNrs.page(pageInfo.page).draw(false);
    }

    function ModifyDirectlyNrs(btn) {
        var id = $(btn).attr('id');
        var row = $(btn).attr('row');
        var col = $(btn).attr('col');
        var new_values = $("#" + id).val();
        var key = id.split('--')[1] + '--' + id.split('--')[2];

        console.log("New: " + key);
        var indexNrs = tableNrs
            .rows()
            .indexes()
            .filter(function (value, index) {
                return key === tableNrs.row(value).data().UK_KEY;
            });

        if (indexNrs !== undefined && tableNrs.row(indexNrs).length > 0) {
            var page = tableNrs.page.info();
            tableNrs.page(page.page).cell(row, col).data(new_values).draw(false);
            CalculateNrs(indexNrs);
            CalculateNrsFoot();
        } else {
            console.log("Invalid row index:", indexNrs);
        }
    }

    function CalculateNrs(indexNrs) {
        var page = tableNrs.page.info();
        if (numeral(tableNrs.row(indexNrs).data().PD_AMT)._value > 0 && numeral(tableNrs.row(indexNrs).data().PD_WGHT)._value > 0) {
            tableNrs.row(indexNrs).data().PD_WGHT_AV = (numeral(tableNrs.row(indexNrs).data().PD_WGHT)._value / numeral(tableNrs.row(indexNrs).data().PD_AMT)._value);
        }
        tableNrs.row(indexNrs).data(tableNrs.row(indexNrs).data()).draw();
        tableNrs.page(page.page).draw(false);
    }

    function CalculateNrsFoot() {
        var sum_PD_TOT_QTY = 0;
        var sum_PD_WGHT = 0;
        for (var i = 0; i < tableNrs.data().length; i++) {
            sum_PD_TOT_QTY = numeral(sum_PD_TOT_QTY)._value + numeral(tableNrs.data()[i].PD_AMT)._value;
            sum_PD_WGHT = numeral(sum_PD_WGHT)._value + numeral(tableNrs.data()[i].PD_WGHT)._value;
        }
        $("#PD_TOT_QTY_NRS").val(numeral(sum_PD_TOT_QTY)._value);
        $("#PD_AMT_NRS").val(numeral(sum_PD_TOT_QTY)._value * numeral($("#PD_PER_UNIT_NRS").val())._value);
        $("#VCNE_AMT_NRS").val(numeral(sum_PD_TOT_QTY)._value * numeral($("#VCNE_PER_UNIT_NRS").val())._value);
        $("#LGST_AMT_NRS").val(numeral($("#LGST_PER_UNIT_NRS").val())._value);
        $("#OTHR_PLS_AMT_NRS").val(numeral($("#OTHR_PLS_PER_UNIT_NRS").val())._value);
        $("#OTHR_MNS_1_AMT_NRS").val(numeral($("#OTHR_MNS_1_PER_UNIT_NRS").val())._value);
        $("#OTHR_MNS_2_AMT_NRS").val(numeral($("#OTHR_MNS_2_PER_UNIT_NRS").val())._value);
        $("#NET_WGHT_NRS").val(numeral(sum_PD_WGHT)._value);

        $("#STD_WGHT_NRS").val(numeral(sum_PD_TOT_QTY)._value * 16);
        $("#EXD_STD_WGHT_NRS").val(numeral(sum_PD_WGHT)._value - (numeral(sum_PD_TOT_QTY)._value * 16));
        $("#EXD_STD_WGHT_AMT_NRS").val(numeral($("#EXD_STD_WGHT_NRS").val())._value * numeral($("#EXD_STD_WGHT_PER_UNIT_NRS").val())._value);

        $("#AV_WGHT_NRS").val(sum_PD_WGHT / sum_PD_TOT_QTY);
        $("#TOT_AMT_NRS").val(numeral($("#PD_AMT_NRS").val())._value + numeral($("#EXD_STD_WGHT_AMT_NRS").val())._value + numeral($("#VCNE_AMT_NRS").val())._value + numeral($("#LGST_AMT_NRS").val())._value +
            numeral($("#OTHR_PLS_AMT_NRS").val())._value - (numeral($("#OTHR_MNS_1_AMT_NRS").val())._value + numeral($("#OTHR_MNS_2_AMT_NRS").val())._value));
        $("#NET_AMT_NRS").val(numeral($("#TOT_AMT_NRS").val())._value - numeral($("#DIS_AMT_NRS").val())._value);
    }

    function DelNrs(btn) {
        var id = $(btn).attr('id');
        var idx = $(btn).attr('idx');
        var key = id.split('--')[1] + "--" + id.split('--')[2];

        var indexHead = tableNrs
            .rows()
            .indexes()
            .filter(function (value, index) {
                //console.log(key + "|" + tableNrs.row(value).data().UK_KEY);
                return key === tableNrs.row(value).data().UK_KEY;
            }); // หา row ที่ต้องการจะลบ
        Swal.fire({
            icon: "warning",
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            showCancelButton: true,
            confirmButtonText: 'Yes',
        }).then((result) => {
            if (result.isConfirmed) {

                tableNrs.rows(indexHead).remove().draw(); // ลบ row ที่ค้นหา
                NrsReGenerate();
                CalculateNrsFoot();
            }
        });
    }

    function EditDiscount() {
        $('#m_modal').modal('show');
    };

    function AddDis(btn) {
        tableDis.row.add({
            "UK_KEY": $("#SALE_DOC_ID").val(),
            "AVY_SALE_FOTR_DCN_SK": 0,
            "SALE_DOC_ID": $("#SALE_DOC_ID").val(),
            "CASE_OF_DCN": "",
            "DCN_CUST_ID": 0,
            "TP_PIG": 0,
            "DCN_QTY": 0,
            "DCN_FOR_CTR_CUST_AMT": 0,
            "DCN_UNIT": "",
            "TOT_AMT": ""
        }).draw(false);
        DisReGenerate();
    }

    function DisReGenerate() {
        var pageInfo = tableDis.page.info();
        tableDis.rows().every(function (index) {
            var rowData = this.data();
            var newUK_KEY = String(rowData.UK_KEY).split('--')[0] + "--" + (index + 1);
            rowData.UK_KEY = newUK_KEY; // Update UK_KEY in row data
            this.data(rowData);
        });
        tableDis.page(pageInfo.page).draw(false);
    }

    function ModifyDirectlyDis(btn) {
        var id = $(btn).attr('id');
        var row = $(btn).attr('row');
        var col = $(btn).attr('col');
        var new_values = $("#" + id).val();
        var key = id.split('--')[1] + '--' + id.split('--')[2];

        console.log("New: " + key);
        var indexDis = tableDis
            .rows()
            .indexes()
            .filter(function (value, index) {
                return key === tableDis.row(value).data().UK_KEY;
            });

        if (indexDis !== undefined && tableDis.row(indexDis).length > 0) {
            var page = tableDis.page.info();
            tableDis.page(page.page).cell(row, col).data(new_values).draw(false);
            if (id.split('--')[0] == "DCN_CUST_ID") {
                if (CheckDiscount(key, new_values) == false) {
                    GetDiscount(indexDis, new_values);
                } else {
                    tableDis.page(page.page).cell(row, col).data("").draw(false);
                }
            }
            CalculateDis(indexDis);
        } else {
            console.log("Invalid row index:", indexDis);
        }
    }

    function GetDiscount(indexDis, selectID) {

        $.ajax({
            type: "GET",
            url: pathServer + "/SAL/SELECT_DISCOUNT",
            data: {
                selectID: selectID,
            },
            success: function (response) {
                var page = tableDis.page.info();
                tableDis.row(indexDis).data().TP_PIG = response.TP_PIG;
                tableDis.row(indexDis).data().CASE_OF_DCN = response.CASE_OF_DCN;
                tableDis.row(indexDis).data().DCN_CUST_ID = response.DCN_CUST_ID;
                tableDis.row(indexDis).data().DCN_FOR_CTR_CUST_AMT = response.DCN_FOR_CTR_CUST_AMT;
                tableDis.row(indexDis).data().DCN_UNIT = response.DCN_UNIT;
                tableDis.row(indexDis).data(tableDis.row(indexDis).data()).draw();
                tableDis.page(page.page).draw(false);
            },
            error: function (xhr) {
                //Do Something to handle error
            }
        });
    }
    function CheckDiscount(key, new_values) {
        var duplicate = 0;
        for (var i = 0; i < tableDis.data().length; i++) {
            if (tableDis.data()[i].DCN_CUST_ID != "" && tableDis.data()[i].UK_KEY != key && new_values == tableDis.data()[i].DCN_CUST_ID) {
                console.log("Dup: " + new_values + "|" + tableDis.data()[i].DCN_CUST_ID);
                duplicate = duplicate + 1;
            }
        }

        if (duplicate > 0) {
            Swal.fire({
                icon: "error",
                title: 'Duplicate!',
                text: "You won't able to select this!",
                showCancelButton: false,
                confirmButtonText: 'OK',
            });
            return true;
        } else {
            return false;
        }
    }

    function CalculateDis(indexDis) {
        var page = tableDis.page.info();
        if (numeral(tableDis.row(indexDis).data().DCN_QTY)._value > 0 && numeral(tableDis.row(indexDis).data().DCN_FOR_CTR_CUST_AMT)._value > 0) {
            tableDis.row(indexDis).data().TOT_AMT = (numeral(tableDis.row(indexDis).data().DCN_QTY)._value * numeral(tableDis.row(indexDis).data().DCN_FOR_CTR_CUST_AMT)._value);
        }
        tableDis.row(indexDis).data(tableDis.row(indexDis).data()).draw();
        tableDis.page(page.page).draw(false);
    }

    function DelDis(btn) {
        var id = $(btn).attr('id');
        var idx = $(btn).attr('idx');
        var key = id.split('--')[1] + "--" + id.split('--')[2];

        var indexHead = tableDis
            .rows()
            .indexes()
            .filter(function (value, index) {
                //console.log(key + "|" + tableDis.row(value).data().UK_KEY);
                return key === tableDis.row(value).data().UK_KEY;
            }); // หา row ที่ต้องการจะลบ
        Swal.fire({
            icon: "warning",
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            showCancelButton: true,
            confirmButtonText: 'Yes',
        }).then((result) => {
            if (result.isConfirmed) {
                tableDis.rows(indexHead).remove().draw(); // ลบ row ที่ค้นหา
                DisReGenerate();
                CalculateWnngFoot();
            }
        });
    }

    function CallAddDiscount() {
        //var OTHR_MNS_1_DESC = [];
        var DIS_AMT = 0;
        var EMPTY = false;
        for (var i = 0; i < tableDis.data().length; i++) {
            //OTHR_MNS_1_DESC.push(tableDis.data()[i].CASE_OF_DCN);
            DIS_AMT = DIS_AMT + tableDis.data()[i].TOT_AMT;
            if (tableDis.data()[i].DCN_CUST_ID == "" || tableDis.data()[i].DCN_QTY == 0 || tableDis.data()[i].TOT_AMT == 0) {
                EMPTY = true;
            }
        }
        if (EMPTY == false) {
            if ($("#PD_TP").val() == 2) {
                $("#DIS_AMT_WNNG").val(DIS_AMT);
                CalculateWnngFoot();
            } else if ($("#PD_TP").val() == 3) {
                $("#DIS_AMT_NRS").val(DIS_AMT);
                CalculateNrsFoot();
            }
            $('#m_modal').modal('hide');
        } else {
            Swal.fire({
                icon: "error",
                title: 'Empty!',
                text: "กรุณาเลือกสาเหตุที่มีมูลค่าและระบุจำนวน!",
                showCancelButton: false,
                confirmButtonText: 'OK',
            });
        }

    }

    $("#SAVE").click(function () {
        var minimum_row = false;
        var fully_row = true;
        var row_index = 0;
        var pd_type = $("#PD_TP").val();
        if ($("#SALE_DT").val() != "" && $("#WGHT_PPR_ID").val() != "" && $("#PD_TP").val() != "" && $("#AC_NBR").val() != "") {
            //tableWnng.rows().every(function (index) {
            //    var rowData = this.data();
            //    if (($("#HSG_ID--" + rowData.UK_KEY).val() == "" || numeral($("#PD_WGHT--" + rowData.UK_KEY).val())._value == 0 || numeral($("#PD_AMT--" + rowData.UK_KEY).val())._value == 0) &&
            //        !($("#HSG_ID--" + rowData.UK_KEY).val() == "" && numeral($("#PD_WGHT--" + rowData.UK_KEY).val())._value == 0 && numeral($("#PD_AMT--" + rowData.UK_KEY).val())._value == 0)) {
            //        fully_row = false;

            //    }
            //});
            if (pd_type == 2) {
                for (var i = 0; i < tableWnng.data().length; i++) {
                    if (tableWnng.data()[i].HSG_ID != "" && numeral(tableWnng.data()[i].PD_WGHT)._value != 0 && numeral(tableWnng.data()[i].PD_AMT)._value != 0) {
                        minimum_row = true;
                    }
                    if ((tableWnng.data()[i].HSG_ID == "" || numeral(tableWnng.data()[i].PD_WGHT)._value == 0 || numeral(tableWnng.data()[i].PD_AMT)._value == 0) &&
                        !(tableWnng.data()[i].HSG_ID == "" && numeral(tableWnng.data()[i].PD_WGHT)._value == 0 && numeral(tableWnng.data()[i].PD_AMT)._value == 0)) {
                        fully_row = false;
                        row_index = tableWnng.data()[i].UK_KEY.split('--')[1];
                    }
                }
            } else if (pd_type == 3) {
                tableNrs.rows().every(function (index) {
                    var rowData = this.data();
                    if (rowData.HSG_ID != "" && numeral(rowData.PD_WGHT)._value != 0 && numeral(rowData.PD_AMT)._value != 0) {
                        minimum_row = true;
                    }
                    if ((rowData.HSG_ID == "" || numeral(rowData.PD_WGHT)._value == 0 || numeral(rowData.PD_AMT)._value == 0) &&
                        !(rowData.HSG_ID == "" && numeral(rowData.PD_WGHT)._value == 0 && numeral(rowData.PD_AMT)._value == 0)) {
                        fully_row = false;
                        row_index = index + 1;
                    }
                });
            }

            if (minimum_row == true) {
                if (fully_row == true && (tableWnng.rows().count() > 0 && pd_type == 2) || (tableNrs.rows().count() > 0 && pd_type == 3) || (tableBrdr.rows().count() > 0 && pd_type == 5)) {
                    Swal.fire({
                        icon: "question",
                        title: 'Do you want to save?',
                        text: "Are you sure to Add Sale",
                        showCancelButton: true,
                        confirmButtonText: 'Yes',
                    }).then((result) => {
                        if (result.isConfirmed) {
                            if (pd_type == 2) {
                                saveWnng();
                            } else if (pd_type == 3) {
                                saveNrs();
                            } else if (pd_type == 5) {
                                saveBrdr();
                            }
                        }
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: 'Empty!',
                        text: "กรุณาระบุข้อมูลรายการที่ " + row_index + " ให้ครบถ้วน",
                        showCancelButton: false,
                        confirmButtonText: 'OK',
                    });
                }
            } else {
                Swal.fire({
                    icon: "error",
                    title: 'Empty!',
                    text: "กรุณาระบุข้อมูลให้ครบถ้วน",
                    showCancelButton: false,
                    confirmButtonText: 'OK',
                });
            }

        } else {
            if ($("#SALE_DT").val() == "") {
                $($(SALE_DT).parent()).addClass('alert-validate-date');
                $("#SALE_DT").focus();
            }
            //if ($("#USR_ID").val() == "") {
            //    $($(USR_ID).parent()).addClass('alert-validate-date');
            //}
            if ($("#WGHT_PPR_ID").val() == "") {
                $($(WGHT_PPR_ID).parent()).addClass('alert-validate');
            }
            if ($("#PD_TP").val() == "") {
                $($(PD_TP).parent()).addClass('alert-validate-date');
            }
            if ($("#AC_NBR").val() == "") {
                $($(AC_NBR).parent()).addClass('alert-validate-date');
            }
        }

    });

    function saveWnng() {
        var AVY_SALES_HDR ={};
        var AVY_SALES_DTL = new Array();
        var AVY_SALES_FOTR_WNNG = {};
        var AVY_SALES_FOTR_DCN = new Array();

        AVY_SALES_HDR.PD_TP = $("#PD_TP").val();
        AVY_SALES_HDR.SALE_DOC_ID = $("#SALE_DOC_ID").val();
        AVY_SALES_HDR.SALE_DT = $("#SALE_DT").val();
        AVY_SALES_HDR.SITE_ID = $("#SITE_ID").val();
        AVY_SALES_HDR.USR_ID = $("#USR_ID").val();
        AVY_SALES_HDR.CST_ID = $("#AC_NBR").val();
        AVY_SALES_HDR.WGHT_PPR_ID = $("#WGHT_PPR_ID").val().toString();
        AVY_SALES_HDR.CONSIGNEE = $("#CONSIGNEE").val();
        AVY_SALES_HDR.SHIPPER = $("#SHIPPER").val();
        AVY_SALES_HDR.AUDITER = $("#AUDITER").val();
        AVY_SALES_HDR.SIGNATORY = $("#SIGNATORY").val();

        for (var i = 0; i < tableWnng.data().length; i++) {
            let tbwnng_d = {};
            tbwnng_d.SALE_DOC_ID = $("#SALE_DOC_ID").val();
            tbwnng_d.SEQ = tableWnng.data()[i].SEQ;
            tbwnng_d.HSG_ID = tableWnng.data()[i].HSG_ID;
            tbwnng_d.BRDR_F = 0;
            tbwnng_d.PD_AMT = numeral(tableWnng.data()[i].PD_AMT)._value;
            tbwnng_d.PD_WGHT = numeral(tableWnng.data()[i].PD_WGHT)._value;
            tbwnng_d.PD_WGHT_AV = numeral(tableWnng.data()[i].PD_WGHT_AV)._value;
            AVY_SALES_DTL.push(tbwnng_d);
        }

        AVY_SALES_FOTR_WNNG.SALE_DOC_ID = $("#SALE_DOC_ID").val();
        AVY_SALES_FOTR_WNNG.PD_TP = $("#PD_TP").val();
        AVY_SALES_FOTR_WNNG.PD_DESC = $("#PD_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.PD_TOT_QTY = numeral($("#PD_TOT_QTY_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.PD_PER_UNIT = numeral($("#PD_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.VCNE_DESC = $("#VCNE_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.VCNE_PER_UNIT = numeral($("#VCNE_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.LGST_DESC = $("#LGST_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.LGST_PER_UNIT = numeral($("#LGST_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.OTHR_PLS_DESC = $("#OTHR_PLS_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.OTHR_PLS_PER_UNIT = numeral($("#OTHR_PLS_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.OTHR_MNS_1_DESC = $("#OTHR_MNS_1_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.OTHR_MNS_1_PER_UNIT = numeral($("#OTHR_MNS_1_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.OTHR_MNS_2_DESC = $("#OTHR_MNS_2_DESC_WNNG").val();
        AVY_SALES_FOTR_WNNG.OTHR_MNS_2_PER_UNIT = numeral($("#OTHR_MNS_2_PER_UNIT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.AV_WGHT = numeral($("#AV_WGHT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.NET_WGHT = numeral($("#NET_WGHT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.TOT_AMT = numeral($("#TOT_AMT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.DIS_AMT = numeral($("#DIS_AMT_WNNG").val())._value;
        AVY_SALES_FOTR_WNNG.NET_AMT = numeral($("#NET_AMT_WNNG").val())._value;

        for (var i = 0; i < tableDis.data().length; i++) {
            var tbdcn = {};
            tbdcn.SALE_DOC_ID = tableDis.data()[i].SALE_DOC_ID;
            tbdcn.DCN_CUST_ID = tableDis.data()[i].DCN_CUST_ID;
            tbdcn.TP_PIG = tableDis.data()[i].TP_PIG;
            tbdcn.CASE_OF_DCN = tableDis.data()[i].CASE_OF_DCN;
            tbdcn.DCN_QTY = tableDis.data()[i].DCN_QTY;
            tbdcn.DCN_FOR_CTR_CUST_AMT = tableDis.data()[i].DCN_FOR_CTR_CUST_AMT;
            tbdcn.DCN_UNIT = tableDis.data()[i].DCN_UNIT;
            tbdcn.TOT_AMT = tableDis.data()[i].TOT_AMT;
            AVY_SALES_FOTR_DCN.push(tbdcn);
        }

        $.ajax({
            contentType: "application/json; charset=utf-8",// กำหนด content สำหรับส่งข้อมูลแบบ object or list
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_UPDATE_WNNG",
            dataType: "json",
            data: JSON.stringify({ AVY_SALES_HDR: AVY_SALES_HDR, AVY_SALES_DTL: AVY_SALES_DTL, AVY_SALES_FOTR_WNNG: AVY_SALES_FOTR_WNNG, AVY_SALES_FOTR_DCN: AVY_SALES_FOTR_DCN }), //parameter Object,List
            xhr: function () {
                var xhr = new window.XMLHttpRequest();
                let timerInterval;
                xhr_loading(xhr);
                clearInterval(timerInterval);
                return xhr;
            },
            success: function (data) {

                clearInterval(interVal);
                $('#progress').css('width', 100 + "%");
                //successMessage.init();
                setTimeout(function () {
                    //Attach_File();
                    Swal.fire({
                        icon: "success",
                        title: 'Your data has been saved',
                        showConfirmButton: true,
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        location.reload();
                    });
                }, 1500);
            },
            error: function () {
                errorAlert.init();
            }
        });
    }

    function saveNrs() {
        var AVY_SALES_HDR = {};
        var AVY_SALES_DTL = new Array();
        var AVY_SALE_FOTR_NRSRY = {};
        var AVY_SALES_FOTR_DCN = new Array();

        AVY_SALES_HDR.PD_TP = $("#PD_TP").val();
        AVY_SALES_HDR.SALE_DOC_ID = $("#SALE_DOC_ID").val();
        AVY_SALES_HDR.SALE_DT = $("#SALE_DT").val();
        AVY_SALES_HDR.USR_ID = $("#USR_ID").val();
        AVY_SALES_HDR.SITE_ID = $("#SITE_ID").val();
        AVY_SALES_HDR.CST_ID = $("#AC_NBR").val();
        AVY_SALES_HDR.WGHT_PPR_ID = $("#WGHT_PPR_ID").val().toString();
        AVY_SALES_HDR.NET_PRC_AMT = $("#NET_AMT").val();
        AVY_SALES_HDR.CONSIGNEE = $("#CONSIGNEE").val();
        AVY_SALES_HDR.SHIPPER = $("#SHIPPER").val();
        AVY_SALES_HDR.AUDITER = $("#AUDITER").val();
        AVY_SALES_HDR.SIGNATORY = $("#SIGNATORY").val();

        for (var i = 0; i < tableNrs.data().length; i++) {
            let tbnrs_d = {};
            tbnrs_d.SALE_DOC_ID = $("#SALE_DOC_ID").val();
            tbnrs_d.SEQ = tableNrs.data()[i].UK_KEY.split('--')[1];
            tbnrs_d.HSG_ID = tableNrs.data()[i].HSG_ID;
            tbnrs_d.BRDR_F = 0;
            tbnrs_d.PD_AMT = numeral(tableNrs.data()[i].PD_AMT)._value;
            tbnrs_d.PD_WGHT = numeral(tableNrs.data()[i].PD_WGHT)._value;
            tbnrs_d.PD_WGHT_AV = numeral(tableNrs.data()[i].PD_WGHT_AV)._value;
            AVY_SALES_DTL.push(tbnrs_d);
        }

        AVY_SALE_FOTR_NRSRY.SALE_DOC_ID = $("#SALE_DOC_ID").val();
        AVY_SALE_FOTR_NRSRY.PD_TP = $("#PD_TP").val();
        AVY_SALE_FOTR_NRSRY.PD_DESC = $("#PD_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.PD_TOT_QTY = numeral($("#PD_TOT_QTY_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.PD_PER_UNIT = numeral($("#PD_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.STD_WGHT = numeral($("#STD_WGHT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.EXD_STD_WGHT = numeral($("#EXD_STD_WGHT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.EXD_STD_WGHT_PER_UNIT = numeral($("#EXD_STD_WGHT_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.VCNE_DESC = $("#VCNE_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.VCNE_PER_UNIT = numeral($("#VCNE_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.LGST_DESC = $("#LGST_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.LGST_PER_UNIT = numeral($("#LGST_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.OTHR_PLS_DESC = $("#OTHR_PLS_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.OTHR_PLS_PER_UNIT = numeral($("#OTHR_PLS_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.OTHR_MNS_1_DESC = $("#OTHR_MNS_1_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.OTHR_MNS_1_PER_UNIT = numeral($("#OTHR_MNS_1_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.OTHR_MNS_2_DESC = $("#OTHR_MNS_2_DESC_NRS").val();
        AVY_SALE_FOTR_NRSRY.OTHR_MNS_2_PER_UNIT = numeral($("#OTHR_MNS_2_PER_UNIT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.AV_WGHT = numeral($("#AV_WGHT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.NET_WGHT = numeral($("#NET_WGHT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.TOT_AMT = numeral($("#TOT_AMT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.DIS_AMT = numeral($("#DIS_AMT_NRS").val())._value;
        AVY_SALE_FOTR_NRSRY.NET_AMT = numeral($("#NET_AMT_NRS").val())._value;

        for (var i = 0; i < tableDis.data().length; i++) {
            var tbdcn = {};
            tbdcn.SALE_DOC_ID = tableDis.data()[i].SALE_DOC_ID;
            tbdcn.DCN_CUST_ID = tableDis.data()[i].DCN_CUST_ID;
            tbdcn.TP_PIG = tableDis.data()[i].TP_PIG;
            tbdcn.CASE_OF_DCN = tableDis.data()[i].CASE_OF_DCN;
            tbdcn.DCN_QTY = tableDis.data()[i].DCN_QTY;
            tbdcn.DCN_FOR_CTR_CUST_AMT = tableDis.data()[i].DCN_FOR_CTR_CUST_AMT;
            tbdcn.DCN_UNIT = tableDis.data()[i].DCN_UNIT;
            tbdcn.TOT_AMT = tableDis.data()[i].TOT_AMT;
            AVY_SALES_FOTR_DCN.push(tbdcn);
        }

        $.ajax({
            contentType: "application/json; charset=utf-8",// กำหนด content สำหรับส่งข้อมูลแบบ object or list
            type: "POST",
            url: pathServer + "/SAL/TFRSALDT03_UPDATE_NRS",
            dataType: "json",
            data: JSON.stringify({ AVY_SALES_HDR: AVY_SALES_HDR, AVY_SALES_DTL: AVY_SALES_DTL, AVY_SALE_FOTR_NRSRY: AVY_SALE_FOTR_NRSRY, AVY_SALES_FOTR_DCN: AVY_SALES_FOTR_DCN }), //parameter Object,List
            xhr: function () {
                var xhr = new window.XMLHttpRequest();
                let timerInterval;
                xhr_loading(xhr);
                clearInterval(timerInterval);
                return xhr;
            },
            success: function (data) {

                clearInterval(interVal);
                $('#progress').css('width', 100 + "%");
                //successMessage.init();
                setTimeout(function () {
                    //Attach_File();
                    Swal.fire({
                        icon: "success",
                        title: 'Your data has been saved',
                        showConfirmButton: true,
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        location.reload();
                    });
                }, 1500);
            },
            error: function () {
                errorAlert.init();
            }
        });
    }
</script>